# Assemble illumina paired reads with velvet single kmer then scaffold with Bambus2
# Input
PAIR=pair.fastq
PAIR1=pair1.fastq
PAIR2=pair2.fastq
K=39
THREADS=1
MASCRIPTDIR=/bubo/home/h16/inod/glob/github/metassemble/scripts

# Output
HOUT=velvet_$(K)/Sequences
GOUT=velvet_$(K)/contigs.fa
BAMBUS2OUT=velvet_$(K)/bambus2/bambus2.scaffold.linear.fasta

all: $(GOUT) $(BAMBUS2OUT)

velvet_%/Sequences: pair.fastq
	velveth velvet_$* $* -fastq -shortPaired $(PAIR)

velvet_%/contigs.fa: velvet_%/Sequences
	velvetg velvet_$* -scaffolding no -exp_cov auto

velvet_%/bambus2/bambus2.scaffold.linear.fasta: velvet_%/contigs.fa $(PAIR1) $(PAIR2)
	$(eval APAIR1=$(shell readlink -f $(PAIR1)))
	$(eval APAIR2=$(shell readlink -f $(PAIR2)))
	$(eval ACONTIGS=$(shell readlink -f $<))
	cd velvet_$* && \
		$(MAKE) -f $(MASCRIPTDIR)/makefile-examples/fastq-pe-contigs-scaf-bambus2 \
		'THREADS=$(THREADS)' \
		'PAIR1=$(APAIR1)' \
		'PAIR2=$(APAIR2)' \
		'CONTIGS=$(ACONTIGS)' \
		all

clean:
	rm -rf velvet_$(K)

.PHONY: all

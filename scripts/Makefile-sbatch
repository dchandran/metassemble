include /gulo/glob/inod/github/gnu-make-sbatch-tools/sbatch.mk
include /gulo/glob/inod/github/metassemble/scripts/parameters.mk

PROJECT:=b2010008
NAME:=ino.debruijn
EXT:=se
DOMAIN:=scilifelab.$(EXT)
EMAIL:=$(NAME)@$(DOMAIN)

SBATCH_STD_OPT=-A $(PROJECT) --output=$@-slurm-%j.out -J $@

################################
# ----- general rules -------- #
################################
%.fastq.gz: %.fastq
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 1-00:00:00 -p core,make -e $@)
################################
# ---- /general rules -------- #
################################

################################
# ------ quality trim -------- #
################################
$(PRC_READS_OUT)/$(FASTQBASE).qtrim: $(FASTQ1) $(FASTQ2)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 06:00:00 -p core,make -e $@)
################################
# ------ /quality trim ------- #
################################

################################
# ---------- velveth --------- #
################################
$(VELVETH_OUT)/velveth_$(KMIN)/Sequences: $(PRC_READS_OUT)/$(FASTQBASE).qtrim
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
$(VELVETH_OUT)/velveth_%/Roadmaps: $(VELVETH_OUT)/velveth_$(KMIN)/Sequences
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
################################
# --------- /velveth --------- #
################################

################################
# --------- velvetg ---------- #
################################
$(VELVET_OUT_NOSCAF)/noscaf_%/contigs.fa: $(VELVETH_OUT)/velveth_%/Roadmaps
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 02:00:00 -p node,make -e $@)
$(VELVET_OUT_SCAF)/scaf_%/contigs.fa: $(VELVETH_OUT)/velveth_%/Roadmaps
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 02:00:00 -p node,make -e $@)
################################
# --------- /velvetg --------- #
################################

################################
# ------- meta-velvetg ------- #
################################
$(METAVELVET_OUT_NOSCAF)/noscaf_%/meta-velvetg.contigs.fa: $(VELVETH_OUT)/velveth_%/Roadmaps
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 02:00:00 -p node,make -e $@)
$(METAVELVET_OUT_SCAF)/scaf_%/meta-velvetg.contigs.fa: $(VELVETH_OUT)/velveth_%/Roadmaps
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 02:00:00 -p node,make -e $@)
################################
# ------- /meta-velvetg ------ #
################################

################################
# --------- minimus2  -------- #
################################
$(MINIMUS2_OUT_VELVET_NOSCAF)/all-merged.fasta: $(VELVETG_OUT_NOSCAF)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
$(MINIMUS2_OUT_METAVELVET_NOSCAF)/all-merged.fasta: $(METAVELVETG_OUT_NOSCAF)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
$(MINIMUS2_OUT_RAY_NOSCAF)/all-merged.fasta: $(RAY_CONTIGS_OUT)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
################################
# --------- /minimus2  ------- #
################################

################################
# --------- newbler -----------#
################################
$(NEWBLER_OUT_VELVET_NOSCAF)/454AllContigs.fna: $(VELVETG_OUT_NOSCAF)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
$(NEWBLER_OUT_METAVELVET_NOSCAF)/454AllContigs.fna: $(METAVELVETG_OUT_NOSCAF)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
$(NEWBLER_OUT_RAY_NOSCAF)/454AllContigs.fna: $(RAY_CONTIGS_OUT)
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
################################
# -------- /newbler -----------#
################################

################################
# --------- bambus2 -----------#
################################
%/bambus2/bambus2.scaffold.linear.fasta: %/all-merged.fasta
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
%/bambus2/bambus2.scaffold.linear.fasta: %/contigs.fa
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
%/bambus2/bambus2.scaffold.linear.fasta: %/454AllContigs.fna
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
%/bambus2/bambus2.scaffold.linear.fasta: %/meta-velvetg.contigs.fa
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
%/bambus2/bambus2.scaffold.linear.fasta: %/Contigs.fasta
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
%/bambus2/bambus2.scaffold.linear.fasta: %/ma-contigs.fasta
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
################################
# -------- /bambus2 -----------#
################################

################################
# ----------- ray -------------#
################################
$(RAY_OUT)/noscaf/noscaf_%/ma-contigs.fasta: $(PRC_READS_OUT)/$(FASTQBASE).qtrim
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 01-00:00:00 -p node,make -e $@)
$(RAY_OUT)/scaf/scaf_%/ma-scaffolds.fasta: $(RAY_OUT)/noscaf/noscaf_%/ma-contigs.fasta
	$(call schedule_with_deps_and_store_id,$(SBATCH_STD_OPT) -t 00:05:00 --qos=short -p core,make -e $@)
################################
# ---------- /ray -------------#
################################
